<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Desa Wire - Projects</title>
    <link rel="icon" type="image/png" href="/img/icon.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="/js/notifications.js"></script>
    <script src="/js/chat-widget.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Root CSS Variables for Responsive Design - FIXED FOR 100% ZOOM */
        :root {
            font-size: 14px; /* Reduced from 16px - this makes everything proportionally smaller */
            --header-height: clamp(3rem, 6vh, 3.5rem);
            --content-padding: clamp(0.75rem, 2.5vw, 1.5rem);
            --card-gap: clamp(0.75rem, 1.5vw, 1rem);
            --border-radius: clamp(0.375rem, 0.8vw, 0.5rem);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f5f6fa;
            color: #333;
            font-size: 1rem;
            overflow-x: hidden;
        }

        .header {
            background: white;
            border-bottom: 1px solid #e1e5e9;
            padding: clamp(0.5rem, 1.2vh, 0.625rem) clamp(0.75rem, 2.5vw, 1.5rem);
            height: var(--header-height);
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            gap: clamp(0.5rem, 1.5vw, 1rem);
            flex-wrap: wrap;
        }

        .logo {
            display: flex;
            align-items: center;
            font-size: clamp(0.875rem, 1.8vw, 1rem);
            font-weight: 600;
            color: #2c5282;
            gap: clamp(0.375rem, 1.2vw, 0.75rem);
        }

        .desa-logo {
            width: clamp(24px, 3.5vw, 28px);
            height: clamp(24px, 3.5vw, 28px);
            border-radius: 4px;
        }

        .logo-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 6px;
            margin-right: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 14px;
        }

        /* Mobile Menu Toggle Button */
        .mobile-menu-toggle {
            display: none;
            background: none;
            border: none;
            font-size: 1.25rem;
            color: #666;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 4px;
            transition: all 0.2s;
        }

        .mobile-menu-toggle:hover {
            background: rgba(0, 0, 0, 0.05);
            color: #2c5282;
        }

        .nav {
            display: flex;
            gap: clamp(0.75rem, 2.5vw, 1.5rem);
            flex-wrap: wrap;
            transition: all 0.3s ease;
        }

        .nav-item {
            padding: clamp(0.3rem, 0.8vh, 0.4rem) 0;
            color: #666;
            text-decoration: none;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
            font-size: clamp(0.8125rem, 1.3vw, 0.9375rem);
            white-space: nowrap;
        }

        .nav-item.active {
            color: #2c5282;
            border-bottom-color: #3182ce;
        }

        .nav-item:hover {
            color: #2c5282;
        }

        .user-section {
            display: flex;
            align-items: center;
            gap: 15px;
            color: #666;
            font-size: 14px;
            position: relative;
        }

        .user-dropdown {
            position: relative;
            cursor: pointer;
        }

        .user-dropdown-content {
            display: none;
            position: absolute;
            right: 0;
            top: 100%;
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            min-width: 200px;
            z-index: 1000;
            margin-top: 5px;
        }

        .user-dropdown-content.show {
            display: block;
        }

        .user-dropdown-header {
            padding: 15px;
            border-bottom: 1px solid #f1f5f9;
        }

        .user-full-name {
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 5px;
        }

        .user-email {
            color: #718096;
            font-size: 13px;
        }

        .user-plan {
            color: #718096;
            font-size: 12px;
            margin-top: 5px;
        }

        .user-dropdown-menu {
            padding: 8px 0;
        }

        .user-dropdown-item {
            padding: 8px 15px;
            color: #4a5568;
            text-decoration: none;
            display: block;
            transition: background 0.2s;
        }

        .user-dropdown-item:hover {
            background: #f7fafc;
        }

        .notification-icon {
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: background 0.2s;
            color: #666;
            font-size: 16px;
        }

        .notification-icon:hover {
            background: rgba(0,0,0,0.1);
        }

        .notification-panel, .help-panel {
            position: absolute;
            top: calc(100% + 10px);
            right: 0;
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
            width: 350px;
            max-height: 500px;
            overflow-y: auto;
            z-index: 10000;
            display: none;
        }

        .notification-panel.show, .help-panel.show {
            display: block;
            animation: slideDown 0.2s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .panel-header {
            padding: 20px;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .panel-title {
            font-size: 16px;
            font-weight: 700;
            color: #2d3748;
        }

        .mark-all-read {
            font-size: 12px;
            color: #3182ce;
            cursor: pointer;
            font-weight: 500;
        }

        .mark-all-read:hover {
            text-decoration: underline;
        }

        .notification-item {
            padding: 15px 20px;
            border-bottom: 1px solid #f7fafc;
            cursor: pointer;
            transition: background 0.2s;
        }

        .notification-item:hover {
            background: #f7fafc;
        }

        .notification-item.unread {
            background: #ebf8ff;
        }

        .notification-header {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            margin-bottom: 5px;
        }

        .notification-icon-circle {
            width: 8px;
            height: 8px;
            background: #3182ce;
            border-radius: 50%;
            margin-top: 5px;
            flex-shrink: 0;
        }

        .notification-content {
            flex: 1;
        }

        .notification-title {
            font-size: 14px;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 3px;
        }

        .notification-message {
            font-size: 13px;
            color: #718096;
            line-height: 1.4;
        }

        .notification-time {
            font-size: 11px;
            color: #a0aec0;
            margin-top: 5px;
        }

        .help-item {
            padding: 15px 20px;
            border-bottom: 1px solid #f7fafc;
            cursor: pointer;
            transition: background 0.2s;
        }

        .help-item:hover {
            background: #f7fafc;
        }

        .help-item-title {
            font-size: 14px;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 5px;
        }

        .help-item-desc {
            font-size: 13px;
            color: #718096;
            line-height: 1.4;
        }

        .empty-state {
            padding: 40px 20px;
            text-align: center;
            color: #a0aec0;
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 10px;
        }

        .empty-state-text {
            font-size: 14px;
        }

        .notification-filters {
            padding: 12px 16px;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            background: #f8fafc;
        }

        .filter-btn {
            padding: 6px 14px;
            border: 1px solid #e2e8f0;
            background: white;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            color: #64748b;
            cursor: pointer;
            transition: all 0.2s;
        }

        .filter-btn:hover {
            background: #f1f5f9;
            border-color: #cbd5e0;
        }

        .filter-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: transparent;
        }

        .notification-type-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 600;
            margin-left: 8px;
        }

        .notification-type-badge.People {
            background: #e6f7ff;
            color: #1890ff;
        }

        .notification-type-badge.Project {
            background: #f0f5ff;
            color: #6366f1;
        }

        .notification-type-badge.Account {
            background: #fff7e6;
            color: #fa8c16;
        }

        .notification-type-badge.Alerts {
            background: #fff1f0;
            color: #f5222d;
        }

        .notification-type-badge.Tasks {
            background: #f6ffed;
            color: #52c41a;
        }

        .notification-type-badge.Forms {
            background: #f9f0ff;
            color: #722ed1;
        }

        .main-content {
            padding: var(--content-padding);
            max-width: clamp(60rem, 92vw, 80rem);
            margin: 0 auto;
            width: 100%;
        }

        .content-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: clamp(1rem, 3vh, 1.5rem);
            gap: var(--card-gap);
            flex-wrap: wrap;
        }

        .action-buttons {
            display: flex;
            gap: clamp(0.5rem, 1.5vw, 0.75rem);
            align-items: center;
            flex-wrap: wrap;
        }

        .new-project-btn {
            background: #3182ce;
            color: white;
            border: none;
            padding: clamp(0.5rem, 1.2vh, 0.625rem) clamp(0.875rem, 1.8vw, 1rem);
            border-radius: var(--border-radius);
            font-size: clamp(0.8125rem, 1.3vw, 0.9375rem);
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: clamp(0.3rem, 0.8vw, 0.4rem);
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(49, 130, 206, 0.2);
            white-space: nowrap;
        }

        .new-project-btn.invite-btn {
            background: #805ad5;
            box-shadow: 0 2px 4px rgba(128, 90, 213, 0.2);
        }

        .new-project-btn.invite-btn:hover {
            background: #6b46c1;
            box-shadow: 0 4px 8px rgba(128, 90, 213, 0.3);
        }

        .new-project-btn:hover {
            background: #2c5282;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(49, 130, 206, 0.3);
        }

        .new-project-btn:active {
            transform: translateY(0);
        }

        .controls {
            display: flex;
            gap: clamp(0.5rem, 1.5vw, 0.75rem);
            align-items: center;
            flex-wrap: wrap;
        }

        .control-btn {
            background: white;
            border: 1px solid #e2e8f0;
            padding: clamp(0.4rem, 1.2vh, 0.5rem) clamp(0.625rem, 1.8vw, 0.875rem);
            border-radius: var(--border-radius);
            font-size: clamp(0.8125rem, 1.3vw, 0.9375rem);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: clamp(0.3rem, 0.8vw, 0.4rem);
            transition: all 0.2s;
            white-space: nowrap;
        }

        .control-btn:hover {
            border-color: #cbd5e0;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .search-box {
            background: white;
            border: 1px solid #e2e8f0;
            padding: clamp(0.4rem, 1.2vh, 0.5rem) clamp(0.625rem, 1.8vw, 0.875rem);
            border-radius: var(--border-radius);
            font-size: clamp(0.8125rem, 1.3vw, 0.9375rem);
            width: clamp(10rem, 22vw, 14rem);
            min-width: 9rem;
            transition: border-color 0.2s;
        }

        .search-box:focus {
            outline: none;
            border-color: #3182ce;
            box-shadow: 0 0 0 3px rgba(49, 130, 206, 0.1);
        }

        .section-title {
            font-size: clamp(0.9375rem, 1.8vw, 1.0625rem);
            font-weight: 600;
            color: #2d3748;
            margin-bottom: clamp(0.75rem, 2vh, 1rem);
        }

        /* Project Tabs Styles - RESPONSIVE */
        .project-tabs {
            display: flex;
            border-bottom: 2px solid #e2e8f0;
            margin-bottom: clamp(1rem, 3vh, 1.5rem);
            gap: 0;
            overflow-x: auto;
            flex-wrap: nowrap;
            -webkit-overflow-scrolling: touch;
        }

        .project-tab {
            background: none;
            border: none;
            padding: clamp(0.5rem, 1.2vh, 0.625rem) clamp(0.875rem, 1.8vw, 1rem);
            font-size: clamp(0.8125rem, 1.3vw, 0.9375rem);
            font-weight: 500;
            color: #718096;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.2s ease;
            position: relative;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .project-tab:hover {
            color: #4a5568;
            background: #f7fafc;
        }

        .project-tab.active {
            color: #3182ce;
            border-bottom-color: #3182ce;
            font-weight: 600;
        }

        .project-tab-count {
            margin-left: 6px;
            font-weight: 400;
        }

        /* Context Menu Styles */
        .context-menu {
            position: absolute;
            background: white;
            border-radius: 8px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
            border: 1px solid #e2e8f0;
            min-width: 180px;
            z-index: 10000;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.2s ease;
        }

        .context-menu.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .context-menu-item {
            padding: 12px 16px;
            cursor: pointer;
            font-size: 14px;
            color: #374151;
            transition: background-color 0.2s ease;
            border-bottom: 1px solid #f3f4f6;
        }

        .context-menu-item:last-child {
            border-bottom: none;
        }

        .context-menu-item:hover {
            background-color: #f7fafc;
        }

        .context-menu-item.disabled {
            color: #9ca3af;
            cursor: not-allowed;
        }

        .context-menu-item.disabled:hover {
            background-color: transparent;
        }

        .context-menu-separator {
            height: 1px;
            background-color: #e2e8f0;
            margin: 4px 0;
        }

        /* Projects Grid - RESPONSIVE */
        .projects-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(clamp(12rem, 18vw, 15rem), 1fr));
            gap: var(--card-gap);
            width: 100%;
        }

        /* Project Card - RESPONSIVE */
        .project-card {
            background: white;
            border-radius: var(--border-radius);
            border: 1px solid #e2e8f0;
            padding: clamp(0.875rem, 2vw, 1rem);
            transition: all 0.2s;
            cursor: pointer;
            position: relative;
        }

        .project-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transform: translateY(-2px);
            border-color: #cbd5e0;
        }

        .project-header {
            display: flex;
            justify-content: between;
            align-items: flex-start;
            margin-bottom: clamp(0.625rem, 1.5vh, 0.875rem);
        }

        .project-title {
            font-size: clamp(0.9375rem, 1.8vw, 1.0625rem);
            font-weight: 600;
            color: #2d3748;
            margin-bottom: clamp(0.2rem, 0.4vh, 0.3rem);
            line-height: 1.3;
        }

        .project-type {
            font-size: clamp(0.6875rem, 1.1vw, 0.8125rem);
            color: #718096;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .project-actions {
            position: absolute;
            top: clamp(0.625rem, 1.5vw, 0.875rem);
            right: clamp(0.625rem, 1.5vw, 0.875rem);
            display: flex;
            gap: clamp(0.2rem, 0.4vw, 0.3rem);
        }

        .action-btn {
            width: clamp(18px, 2.5vw, 22px);
            height: clamp(18px, 2.5vw, 22px);
            border: none;
            background: none;
            cursor: pointer;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #a0aec0;
            transition: all 0.2s;
            font-size: clamp(0.6875rem, 1.3vw, 0.8125rem);
        }

        .action-btn:hover {
            background: #f7fafc;
            color: #4a5568;
        }

        .project-stats {
            display: flex;
            align-items: center;
            gap: clamp(0.3rem, 0.8vw, 0.4rem);
            color: #718096;
            font-size: clamp(0.8125rem, 1.3vw, 0.9375rem);
            flex-wrap: wrap;
        }

        .stat-icon {
            width: clamp(12px, 1.8vw, 14px);
            height: clamp(12px, 1.8vw, 14px);
        }

        .new-project-card {
            border: 2px dashed #cbd5e0;
            background: #f7fafc;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: clamp(9rem, 16vh, 11rem);
            text-align: center;
            color: #718096;
            transition: all 0.2s;
            border-radius: var(--border-radius);
            padding: clamp(0.875rem, 2vw, 1rem);
        }

        .new-project-card:hover {
            border-color: #3182ce;
            background: #ebf8ff;
            color: #3182ce;
        }

        .plus-icon {
            font-size: clamp(1.125rem, 2.5vw, 1.375rem);
            margin-bottom: clamp(0.3rem, 0.8vh, 0.4rem);
        }

        .glass-accent {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Modal Styles - RESPONSIVE */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: flex-start;
            justify-content: center;
            z-index: 10000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            padding: clamp(0.75rem, 2.5vh, 1.5rem) clamp(0.5rem, 1.5vw, 0.75rem);
        }

        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
            width: clamp(18rem, 90vw, 30rem);
            max-height: calc(100vh - clamp(1.5rem, 5vh, 3rem));
            overflow-y: auto;
            transform: scale(0.9) translateY(-20px);
            transition: all 0.3s ease;
        }

        .modal-overlay.show .modal {
            transform: scale(1) translateY(0);
        }

        .modal-header {
            padding: clamp(0.875rem, 2.5vh, 1.25rem) clamp(0.875rem, 2.5vw, 1.25rem) 0 clamp(0.875rem, 2.5vw, 1.25rem);
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid #e2e8f0;
            margin-bottom: clamp(0.875rem, 2.5vh, 1.25rem);
        }

        .modal-title {
            font-size: clamp(1.0625rem, 2.2vw, 1.1875rem);
            font-weight: 700;
            color: #2d3748;
            margin: 0;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            color: #a0aec0;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: all 0.2s ease;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-close:hover {
            background: #f7fafc;
            color: #4a5568;
        }

        .modal-body {
            padding: 0 clamp(0.875rem, 2.5vw, 1.25rem) clamp(0.875rem, 2.5vh, 1.25rem) clamp(0.875rem, 2.5vw, 1.25rem);
        }

        .form-group {
            margin-bottom: clamp(0.875rem, 2vh, 1rem);
        }

        .form-label {
            display: block;
            font-size: clamp(0.8125rem, 1.3vw, 0.9375rem);
            font-weight: 600;
            color: #374151;
            margin-bottom: clamp(0.3rem, 0.8vh, 0.4rem);
        }

        .form-label.required::after {
            content: " *";
            color: #e53e3e;
        }

        .form-input {
            width: 100%;
            padding: clamp(0.5rem, 1.2vh, 0.625rem) clamp(0.625rem, 1.8vw, 0.875rem);
            border: 2px solid #e2e8f0;
            border-radius: var(--border-radius);
            font-size: clamp(0.8125rem, 1.3vw, 0.9375rem);
            transition: all 0.3s ease;
            background: #fafafa;
        }

        .form-input:focus {
            outline: none;
            border-color: #3182ce;
            background: white;
            box-shadow: 0 0 0 3px rgba(49, 130, 206, 0.1);
        }

        .form-input::placeholder {
            color: #a0aec0;
            font-weight: 400;
        }

        .form-select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            background: #fafafa;
            cursor: pointer;
            transition: all 0.3s ease;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23a0aec0' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 16px;
            padding-right: 40px;
        }

        .form-select:focus {
            outline: none;
            border-color: #3182ce;
            background-color: white;
            box-shadow: 0 0 0 3px rgba(49, 130, 206, 0.1);
        }

        .form-select optgroup {
            font-weight: 600;
            color: #4a5568;
            background-color: #f7fafc;
            padding: 8px 0;
        }

        .form-select option {
            padding: 8px 12px;
            color: #2d3748;
        }

        .form-select option:checked {
            background-color: #3182ce;
            color: white;
        }

        .modal-footer {
            padding: 20px 24px 24px 24px;
            border-top: 1px solid #e2e8f0;
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        .btn-secondary {
            background: #f7fafc;
            color: #4a5568;
            border: 1px solid #e2e8f0;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-secondary:hover {
            background: #edf2f7;
            border-color: #cbd5e0;
        }

        .btn-primary {
            background: linear-gradient(135deg, #3182ce 0%, #2c5282 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(49, 130, 206, 0.2);
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(49, 130, 206, 0.3);
        }

        .btn-primary:active {
            transform: translateY(0);
        }

        .btn-primary:disabled {
            background: #a0aec0;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* Filter Modal Styles */
        .filter-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .filter-modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .filter-modal {
            background: white;
            border-radius: 12px;
            width: 90%;
            max-width: 480px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 25px rgba(0, 0, 0, 0.15);
            transform: translateY(-20px);
            transition: transform 0.3s ease;
        }

        .filter-modal-overlay.show .filter-modal {
            transform: translateY(0);
        }

        .filter-modal-header {
            padding: 24px 24px 0 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .filter-modal-title {
            font-size: 18px;
            font-weight: 700;
            color: #1a202c;
            margin: 0;
        }

        .filter-modal-close {
            background: none;
            border: none;
            font-size: 20px;
            color: #9ca3af;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: color 0.2s;
        }

        .filter-modal-close:hover {
            color: #4a5568;
        }

        .filter-modal-body {
            padding: 24px;
        }

        .filter-section {
            margin-bottom: 24px;
        }

        .filter-section:last-child {
            margin-bottom: 0;
        }

        .filter-section-title {
            font-size: 14px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 12px;
        }

        .filter-input {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
            background: white;
            transition: border-color 0.2s;
            box-sizing: border-box;
        }

        .filter-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .filter-select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
            background: white;
            cursor: pointer;
            transition: border-color 0.2s;
        }

        .filter-select:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .filter-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 0;
        }

        .filter-toggle-text {
            font-size: 14px;
            color: #374151;
        }

        .toggle-switch {
            position: relative;
            width: 44px;
            height: 24px;
            background: #d1d5db;
            border-radius: 12px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .toggle-switch.active {
            background: #3b82f6;
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: transform 0.2s;
        }

        .toggle-switch.active::after {
            transform: translateX(20px);
        }

        .filter-modal-footer {
            padding: 20px 24px 24px 24px;
            display: flex;
            justify-content: space-between;
            gap: 12px;
        }

        .filter-btn {
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
        }

        .filter-btn-primary {
            background: #3b82f6;
            color: white;
        }

        .filter-btn-primary:hover {
            background: #2563eb;
        }

        .filter-btn-secondary {
            background: white;
            color: #374151;
            border: 1px solid #d1d5db;
        }

        .filter-btn-secondary:hover {
            background: #f9fafb;
        }

        /* Sort Dropdown Modal Styles */
        .sort-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: transparent;
            z-index: 10000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s ease;
        }

        .sort-modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .sort-modal {
            position: absolute;
            background: white;
            border-radius: 12px;
            width: 200px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
            transform: translateY(-10px);
            transition: transform 0.2s ease;
            border: 1px solid #e2e8f0;
        }

        .sort-modal-overlay.show .sort-modal {
            transform: translateY(0);
        }


        .sort-modal-header {
            padding: 20px 20px 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .sort-modal-title {
            font-size: 16px;
            font-weight: 600;
            color: #1a202c;
            margin: 0;
        }

        .sort-modal-close {
            background: none;
            border: none;
            font-size: 18px;
            color: #9ca3af;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: color 0.2s;
        }

        .sort-modal-close:hover {
            color: #4a5568;
        }

        .sort-modal-body {
            padding: 8px 0;
        }

        .sort-option {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.2s;
            margin-bottom: 4px;
            font-size: 14px;
            font-weight: 500;
        }

        .sort-option:hover {
            background: #f7fafc;
        }

        .sort-option.selected {
            background: #ebf8ff;
            color: #3182ce;
        }

        .sort-option:last-child {
            margin-bottom: 0;
        }

        /* ========== RESPONSIVE MEDIA QUERIES ========== */

        /* Extra small devices (max-width: 360px) */
        @media (max-width: 360px) {
            .new-project-btn span:first-child {
                font-size: 1rem;
            }

            .new-project-btn {
                font-size: 0.8125rem;
                padding: 0.5rem 0.75rem;
            }
        }

        /* Mobile devices - Small (max-width: 480px) */
        @media (max-width: 480px) {
            :root {
                font-size: 14px;
                --header-height: auto;
                --content-padding: 0.75rem;
                --card-gap: 0.75rem;
            }

            .header {
                flex-wrap: wrap;
                height: auto;
                min-height: 3rem;
                padding: 0.5rem 0.75rem;
                position: relative;
            }

            .logo {
                flex: 1;
                min-width: 0;
            }

            .logo > div {
                font-size: 0.75rem !important;
            }

            .mobile-menu-toggle {
                display: block;
                order: 2;
            }

            .nav {
                display: none;
                flex-direction: column;
                width: 100%;
                order: 4;
                gap: 0;
                border-top: 1px solid #e1e5e9;
                padding-top: 0.5rem;
                margin-top: 0.5rem;
                background: white;
            }

            .nav.show {
                display: flex;
            }

            .nav-item {
                padding: 0.625rem 0.75rem;
                border-bottom: none;
                border-left: 3px solid transparent;
                width: 100%;
            }

            .nav-item.active {
                border-bottom: none;
                border-left-color: #3182ce;
                background: #f7fafc;
            }

            .user-section {
                gap: 0.5rem;
                font-size: 0.75rem;
                order: 3;
            }

            .notification-panel,
            .help-panel {
                width: calc(100vw - 1rem);
                max-width: none;
                right: 0.5rem;
            }

            .main-content {
                padding: 0.75rem;
            }

            .content-header {
                flex-direction: column;
                gap: 0.75rem;
                align-items: stretch;
            }

            .action-buttons {
                width: 100%;
                flex-direction: column;
                gap: 0.75rem;
            }

            .new-project-btn {
                width: 100%;
                justify-content: center;
                padding: 0.625rem 1rem;
                font-size: 0.875rem;
            }

            .new-project-btn span {
                font-size: 1.125rem;
            }

            .control-btn {
                width: 100%;
                justify-content: center;
                padding: 0.625rem 1rem;
            }

            .controls {
                flex-direction: column;
                width: 100%;
            }

            .search-box {
                width: 100%;
                min-width: auto;
            }

            .projects-grid {
                grid-template-columns: 1fr;
                gap: 0.75rem;
            }

            .project-tabs {
                overflow-x: auto;
                margin-bottom: 1rem;
                padding-bottom: 0.25rem;
            }

            .project-tab {
                font-size: 0.875rem;
                padding: 0.5rem 0.75rem;
            }

            .modal {
                width: calc(100vw - 1rem);
                max-height: calc(100vh - 2rem);
            }

            .modal-header,
            .modal-body {
                padding-left: 1rem;
                padding-right: 1rem;
            }

            .modal-footer {
                flex-direction: column;
                gap: 0.5rem;
            }

            .modal-footer .btn-primary,
            .modal-footer .btn-secondary {
                width: 100%;
            }
        }

        /* Mobile devices - Medium (481px - 600px) */
        @media (min-width: 481px) and (max-width: 600px) {
            :root {
                font-size: 14px;
                --header-height: auto;
            }

            .header {
                flex-wrap: wrap;
                position: relative;
            }

            .mobile-menu-toggle {
                display: block;
            }

            .action-buttons {
                width: 100%;
                gap: 0.75rem;
            }

            .new-project-btn {
                flex: 1;
                min-width: 0;
                justify-content: center;
            }

            .content-header {
                flex-direction: column;
                align-items: stretch;
            }

            .controls {
                width: 100%;
                gap: 0.75rem;
            }

            .control-btn {
                flex: 1;
            }

            .search-box {
                width: 100%;
            }
        }

        /* Mobile devices - Medium-Large (601px - 768px) */
        @media (min-width: 601px) and (max-width: 768px) {
            :root {
                font-size: 14px;
                --header-height: auto;
            }

            .header {
                flex-wrap: wrap;
                position: relative;
            }

            .mobile-menu-toggle {
                display: block;
            }

            .nav {
                display: none;
                flex-direction: column;
                order: 4;
                flex-basis: 100%;
                justify-content: flex-start;
                padding: 0.75rem 0 0.5rem 0;
                border-top: 1px solid #e1e5e9;
                margin-top: 0.5rem;
                gap: 0.25rem;
                background: white;
            }

            .nav.show {
                display: flex;
            }

            .nav-item {
                padding: 0.625rem 1rem;
                border-bottom: none;
                border-left: 3px solid transparent;
                width: 100%;
            }

            .nav-item.active {
                border-bottom: none;
                border-left-color: #3182ce;
                background: #f7fafc;
            }

            .content-header {
                flex-direction: column;
                gap: 1rem;
                align-items: stretch;
            }

            .action-buttons {
                width: 100%;
                gap: 1rem;
            }

            .new-project-btn {
                flex: 1;
                min-width: 0;
                justify-content: center;
            }

            .controls {
                justify-content: space-between;
                gap: 0.75rem;
            }

            .search-box {
                flex: 1;
                min-width: 10rem;
            }

            .projects-grid {
                grid-template-columns: repeat(auto-fill, minmax(15rem, 1fr));
            }

            .notification-panel,
            .help-panel {
                width: calc(100vw - 2rem);
                max-width: 24rem;
            }
        }

        /* Tablet devices (769px - 900px) - Show hamburger menu */
        @media (min-width: 769px) and (max-width: 900px) {
            :root {
                font-size: 14px;
            }

            .mobile-menu-toggle {
                display: block;
            }

            .nav {
                display: none;
                flex-direction: column;
                order: 4;
                flex-basis: 100%;
                justify-content: flex-start;
                padding: 0.75rem 0 0.5rem 0;
                border-top: 1px solid #e1e5e9;
                margin-top: 0.5rem;
                gap: 0.25rem;
                background: white;
            }

            .nav.show {
                display: flex;
            }

            .nav-item {
                padding: 0.625rem 1rem;
                border-bottom: none;
                border-left: 3px solid transparent;
                width: 100%;
            }

            .nav-item.active {
                border-bottom: none;
                border-left-color: #3182ce;
                background: #f7fafc;
            }

            .projects-grid {
                grid-template-columns: repeat(auto-fill, minmax(15rem, 1fr));
            }

            .content-header {
                gap: 1rem;
                flex-wrap: wrap;
            }

            .action-buttons {
                gap: 0.75rem;
                flex-wrap: wrap;
            }

            .new-project-btn {
                flex: 1;
                min-width: max-content;
            }
        }

        /* Tablet devices (901px - 1024px) - Show full navigation */
        @media (min-width: 901px) and (max-width: 1024px) {
            :root {
                font-size: 14px;
            }

            .projects-grid {
                grid-template-columns: repeat(auto-fill, minmax(16rem, 1fr));
            }

            .content-header {
                gap: 1rem;
            }
        }

        /* Desktop devices (1025px - 1440px) */
        @media (min-width: 1025px) and (max-width: 1440px) {
            .projects-grid {
                grid-template-columns: repeat(auto-fill, minmax(17rem, 1fr));
            }
        }

        /* Large desktop (1441px+) */
        @media (min-width: 1441px) {
            :root {
                font-size: 16px;
            }

            .main-content {
                max-width: 90rem;
            }

            .projects-grid {
                grid-template-columns: repeat(auto-fill, minmax(18rem, 1fr));
            }

            .action-buttons {
                gap: 1rem;
            }

            .new-project-btn {
                padding: 0.625rem 1.125rem;
                font-size: 0.9375rem;
            }
        }

        /* Landscape orientation on mobile */
        @media (max-height: 500px) and (orientation: landscape) {
            .header {
                padding: 0.375rem 0.75rem;
                min-height: 2.5rem;
            }

            .notification-panel,
            .help-panel {
                max-height: 80vh;
            }

            .modal {
                max-height: 90vh;
            }
        }

        /* Print styles */
        @media print {
            .header,
            .controls,
            .project-tabs,
            .user-section,
            .new-project-btn {
                display: none;
            }

            .projects-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .project-card {
                page-break-inside: avoid;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="logo">
            <img src="/img/img.webp" alt="Desa Logo" class="desa-logo">
            <div style="display: flex; align-items: center; gap: 15px;">
                <div style="font-size: 18px; font-weight: 600; color: #2c5282;">DESA</div>
                <div style="width: 1px; height: 30px; background: #e1e5e9;"></div>
                <span class="glass-accent">DESA WIRE</span>
            </div>
        </div>
        <button class="mobile-menu-toggle" id="mobileMenuToggle" aria-label="Toggle menu">
            <i class="fas fa-bars"></i>
        </button>
        <nav class="nav" id="mainNav">
            <a href="/" class="nav-item active">Projects</a>
            <a href="/people" class="nav-item">People</a>
            <a href="/account" class="nav-item">Account</a>
        </nav>
        <div class="user-section">
            <span class="notification-icon" id="notificationBell" style="position: relative;">
                üîî
                <span id="notificationBadge" style="
                    position: absolute;
                    top: -2px;
                    right: -2px;
                    background: #e53e3e;
                    color: white;
                    font-size: 10px;
                    font-weight: 600;
                    padding: 2px 5px;
                    border-radius: 10px;
                ">0</span>
            </span>
            <span class="notification-icon" id="helpIcon">‚ùì</span>

            <!-- Notification Panel -->
            <div class="notification-panel" id="notificationPanel">
                <div class="panel-header">
                    <div class="panel-title">Notifications</div>
                    <div class="mark-all-read" id="markAllRead">Mark all as read</div>
                </div>

                <!-- Notification Filters -->
                <div class="notification-filters">
                    <button class="filter-btn active" data-filter="all">All</button>
                    <button class="filter-btn" data-filter="People">People</button>
                    <button class="filter-btn" data-filter="Project">Project</button>
                    <button class="filter-btn" data-filter="Account">Account</button>
                    <button class="filter-btn" data-filter="Alerts">Alerts</button>
                    <button class="filter-btn" data-filter="Tasks">Tasks</button>
                    <button class="filter-btn" data-filter="Forms">Forms</button>
                </div>

                <div id="notificationsList"></div>
            </div>

            <!-- Help Panel -->
            <div class="help-panel" id="helpPanel">
                <div class="panel-header">
                    <div class="panel-title">Help & Support</div>
                </div>
                <div class="help-item" onclick="window.open('https://www.desa.ca/', '_blank')">
                    <div class="help-item-title">üìö Documentation</div>
                    <div class="help-item-desc">Browse our complete documentation</div>
                </div>
                <div class="help-item" onclick="showVideoTutorials()">
                    <div class="help-item-title">üé• Video Tutorials</div>
                    <div class="help-item-desc">Watch step-by-step video guides</div>
                </div>
                <div class="help-item" onclick="contactSupport()">
                    <div class="help-item-title">üí¨ Contact Support</div>
                    <div class="help-item-desc">Get help from our support team</div>
                </div>
                <div class="help-item" onclick="showKeyboardShortcuts()">
                    <div class="help-item-title">‚å®Ô∏è Keyboard Shortcuts</div>
                    <div class="help-item-desc">Learn useful keyboard shortcuts</div>
                </div>
                <div class="help-item" onclick="showWhatsNew()">
                    <div class="help-item-title">‚ú® What's New</div>
                    <div class="help-item-desc">See the latest features and updates</div>
                </div>
            </div>

            <div class="user-dropdown" id="userDropdownToggle">
                <span><%= user ? user.username : 'Guest' %></span>
                <span>‚ñº</span>
                <div class="user-dropdown-content" id="userDropdown">
                    <div class="user-dropdown-header">
                        <div class="user-full-name"><%= user ? user.username : 'Guest' %></div>
                        <div class="user-email"><%= user ? user.email : 'guest@example.com' %></div>
                    </div>
                    <div class="user-dropdown-menu">
                        <a href="#" class="user-dropdown-item" id="editProfileLink">Edit profile</a>
                        <a href="/account" class="user-dropdown-item">View account</a>
                        <a href="#" class="user-dropdown-item" onclick="signOut()">Sign out</a>
                    </div>
                </div>
            </div>
            <span>üá®üá¶</span>
        </div>
    </header>

    <main class="main-content">
        <div class="content-header">
            <div class="action-buttons">
                <button class="new-project-btn" id="newProjectBtn">
                    <span>+</span>
                    New project
                </button>
                <button class="new-project-btn invite-btn" id="inviteUserBtn">
                    <span>üë§</span>
                    Invite user to project
                </button>
            </div>
            <div class="controls">
                <button class="control-btn" id="sortBtn">
                    <span>‚áÖ</span>
                    Sort
                </button>
                <button class="control-btn" id="filterBtn">
                    <span>‚ß®</span>
                    Filter projects
                </button>
                <input type="text" class="search-box" placeholder="Search projects">
            </div>
        </div>

        <div class="project-tabs">
            <button class="project-tab active" id="myProjectsTab">
                My projects<span class="project-tab-count" id="myProjectsCount">(<%= projects ? projects.length : 0 %>)</span>
            </button>
            <button class="project-tab" id="accountProjectsTab">
                Account projects<span class="project-tab-count" id="accountProjectsCount">(0)</span>
            </button>
        </div>

        <div class="projects-grid">
            <% if (projects && projects.length > 0) { %>
                <% projects.forEach(project => { %>
                    <div class="project-card" data-project-id="<%= project.id %>">
                        <div class="project-actions">
                            <button class="action-btn favorite-btn" data-project-id="<%= project.id %>"><%= project.isFavorite ? '‚òÖ' : '‚òÜ' %></button>
                            <button class="action-btn star-btn" data-project-id="<%= project.id %>"><%= project.isStarred ? 'üåü' : '‚≠ê' %></button>
                            <button class="action-btn menu-btn" data-project-id="<%= project.id %>">‚ãØ</button>
                        </div>
                        <div class="project-header">
                            <div>
                                <div class="project-title"><%= project.name %></div>
                                <% if (project.type) { %>
                                    <div class="project-type"><%= project.type %></div>
                                <% } %>
                            </div>
                        </div>
                        <div class="project-stats">
                            <span class="stat-icon">üë•</span>
                            <span><%= project.members %></span>
                        </div>
                    </div>
                <% }) %>
            <% } %>

            <div class="project-card new-project-card" id="newProjectCard">
                <div class="plus-icon">+</div>
                <div>New project</div>
            </div>
        </div>
    </main>

    <!-- Create Project Modal -->
    <div class="modal-overlay" id="createProjectModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Create new project</h2>
                <button class="modal-close" onclick="closeCreateProjectModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="createProjectForm">
                    <div class="form-group">
                        <label for="projectName" class="form-label required">Name</label>
                        <input 
                            type="text" 
                            id="projectName" 
                            name="projectName" 
                            class="form-input" 
                            placeholder="Enter project name"
                            required
                        >
                    </div>
                    <div class="form-group">
                        <label for="projectCode" class="form-label">Code</label>
                        <input 
                            type="text" 
                            id="projectCode" 
                            name="projectCode" 
                            class="form-input" 
                            placeholder="Enter project code"
                        >
                    </div>
                    <div class="form-group">
                        <label for="projectTemplate" class="form-label required">Start with...</label>
                        <select id="projectTemplate" name="projectTemplate" class="form-select" required>
                            <option value="blank">Blank project</option>
                            <option value="clone">Clone existing project</option>
                            <optgroup label="Project templates">
                                <option value="template1">Project Template</option>
                                <option value="template2">Synergy Builds</option>
                            </optgroup>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-secondary" onclick="closeCreateProjectModal()">Cancel</button>
                <button type="button" class="btn-primary" onclick="createProject()" id="createProjectBtn">Create project</button>
            </div>
        </div>
    </div>

    <!-- Sort Projects Modal -->
    <div class="sort-modal-overlay" id="sortModal">
        <div class="sort-modal">
            <div class="sort-modal-body">
                <div class="sort-option selected" data-sort="favorite">Favorite</div>
                <div class="sort-option" data-sort="name">Name</div>
                <div class="sort-option" data-sort="code">Code</div>
                <div class="sort-option" data-sort="label">Label</div>
            </div>
        </div>
    </div>

    <!-- Filter Projects Modal -->
    <div class="filter-modal-overlay" id="filterModal">
        <div class="filter-modal">
            <div class="filter-modal-header">
                <h2 class="filter-modal-title">Filter projects</h2>
                <button class="filter-modal-close" id="closeFilterModal">&times;</button>
            </div>
            <div class="filter-modal-body">
                <div class="filter-section">
                    <div class="filter-section-title">Labels</div>
                    <input type="text" class="filter-input" placeholder="Search labels">
                </div>
                
                <div class="filter-section">
                    <div class="filter-section-title">Projects' account owner</div>
                    <select class="filter-select">
                        <option value="all">All</option>
                        <option value="current-user">Stephen</option>
                        <option value="other">Other users</option>
                    </select>
                </div>
                
                <div class="filter-section">
                    <div class="filter-section-title">Time filters</div>
                    <select class="filter-select" style="margin-bottom: 12px;">
                        <option value="last-modified">Last modified</option>
                        <option value="created">Created</option>
                        <option value="accessed">Last accessed</option>
                    </select>
                    <select class="filter-select">
                        <option value="all-time">All time</option>
                        <option value="today">Today</option>
                        <option value="week">This week</option>
                        <option value="month">This month</option>
                        <option value="year">This year</option>
                    </select>
                </div>
                
                <div class="filter-section">
                    <div class="filter-section-title">Archived</div>
                    <div class="filter-toggle">
                        <div class="filter-toggle-text">View archived projects only</div>
                        <div class="toggle-switch" id="archivedToggle"></div>
                    </div>
                </div>
            </div>
            <div class="filter-modal-footer">
                <button class="filter-btn filter-btn-secondary" id="clearFiltersBtn">Clear filters</button>
                <button class="filter-btn filter-btn-primary" id="viewProjectsBtn">View projects</button>
            </div>
        </div>
    </div>

    <script type="text/javascript">
        // @ts-nocheck
        /* eslint-disable */
        // Global variables - load from server
        let projects = <% if (projects) { %><%- JSON.stringify(projects) %><% } else { %>[]<% } %>;
        let accountProjects = []; // Account projects (empty for now)
        let currentTab = 'myProjects';

        // Initialize notifications
        let notifications = [];

        // Load notifications from server
        async function loadNotifications() {
            try {
                const response = await fetch('/api/notifications');
                const result = await response.json();

                if (result.status === 'success') {
                    notifications = result.data;
                    updateNotificationBadge(result.unreadCount);
                }
            } catch (error) {
                console.error('Error loading notifications:', error);
            }
        }

        // Current notification filter
        let currentFilter = 'all';

        // Render notifications
        function renderNotifications(filter = 'all') {
            const notificationsList = document.getElementById('notificationsList');
            const notificationBadge = document.getElementById('notificationBadge');

            const unreadCount = notifications.filter(n => n.unread).length;

            if (unreadCount > 0) {
                notificationBadge.textContent = unreadCount;
                notificationBadge.style.display = 'block';
            } else {
                notificationBadge.style.display = 'none';
            }

            // Filter notifications
            let filteredNotifications = notifications;
            if (filter !== 'all') {
                filteredNotifications = notifications.filter(n => n.type === filter);
            }

            if (filteredNotifications.length === 0) {
                notificationsList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üîî</div>
                        <div class="empty-state-text">No ${filter === 'all' ? '' : filter + ' '}notifications</div>
                    </div>
                `;
                return;
            }

            notificationsList.innerHTML = filteredNotifications.map(notification => `
                <div class="notification-item ${notification.unread ? 'unread' : ''}" onclick="markAsRead(${notification.id})">
                    <div class="notification-header">
                        ${notification.unread ? '<div class="notification-icon-circle"></div>' : ''}
                        <div class="notification-content">
                            <div class="notification-title">
                                ${notification.title}
                                <span class="notification-type-badge ${notification.type}">${notification.type}</span>
                            </div>
                            <div class="notification-message">${notification.message}</div>
                            <div class="notification-time">${notification.time}</div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Update notification badge count
        function updateNotificationBadge() {
            const unreadCount = notifications.filter(n => n.unread).length;
            const badge = document.getElementById('notificationBadge');
            if (badge) {
                badge.textContent = unreadCount;
                badge.style.display = unreadCount > 0 ? 'block' : 'none';
            }
        }

        // Mark notification as read
        function markAsRead(id) {
            const notification = notifications.find(n => n.id === id);
            if (notification) {
                notification.unread = false;
                renderNotifications();
                updateNotificationBadge();
            }
        }

        // Help functions
        function showVideoTutorials() {
            alert('Video tutorials will be available soon!\n\nStay tuned for step-by-step guides on:\n‚Ä¢ Managing people\n‚Ä¢ Creating projects\n‚Ä¢ Inviting team members\n‚Ä¢ Exporting data');
        }

        function contactSupport() {
            const supportEmail = 'support@desawire.com';
            const subject = 'Support Request';
            const body = 'Hello Desa Wire Support,\n\nI need help with:\n\n';
            window.location.href = `mailto:${supportEmail}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
        }

        function showKeyboardShortcuts() {
            alert('‚å®Ô∏è Keyboard Shortcuts:\n\n' +
                  '‚Ä¢ Ctrl/Cmd + K: Search\n' +
                  '‚Ä¢ Ctrl/Cmd + N: New project\n' +
                  '‚Ä¢ Ctrl/Cmd + E: Export\n' +
                  '‚Ä¢ Ctrl/Cmd + /: Help\n' +
                  '‚Ä¢ Esc: Close modals');
        }

        function showWhatsNew() {
            alert('‚ú® What\'s New in Desa Wire:\n\n' +
                  '‚Ä¢ Real email invitations with beautiful templates\n' +
                  '‚Ä¢ Project selection for user invites\n' +
                  '‚Ä¢ Notification system\n' +
                  '‚Ä¢ Help & support panel\n' +
                  '‚Ä¢ Export users to email\n' +
                  '‚Ä¢ Enhanced UI/UX');
        }

        // Create new project function
        function createNewProject() {
            openCreateProjectModal();
        }

        // Open create project modal
        function openCreateProjectModal() {
            const modal = document.getElementById('createProjectModal');
            modal.classList.add('show');
            document.body.style.overflow = 'hidden';
            
            // Focus on the first input
            setTimeout(() => {
                document.getElementById('projectName').focus();
            }, 100);
        }

        // Close create project modal
        function closeCreateProjectModal() {
            const modal = document.getElementById('createProjectModal');
            modal.classList.remove('show');
            document.body.style.overflow = '';
            
            // Reset form
            document.getElementById('createProjectForm').reset();
        }

        // Close modal when clicking outside
        document.addEventListener('click', function(e) {
            const modal = document.getElementById('createProjectModal');
            if (e.target === modal) {
                closeCreateProjectModal();
            }
        });

        // Close modal with Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                const modal = document.getElementById('createProjectModal');
                if (modal.classList.contains('show')) {
                    closeCreateProjectModal();
                }
                const filterModal = document.getElementById('filterModal');
                if (filterModal.classList.contains('show')) {
                    closeFilterModal();
                }
                const sortModal = document.getElementById('sortModal');
                if (sortModal.classList.contains('show')) {
                    closeSortModal();
                }
            }
        });

        // Filter Modal Functions
        function openFilterModal() {
            const modal = document.getElementById('filterModal');
            modal.classList.add('show');
            document.body.style.overflow = 'hidden';
        }

        function closeFilterModal() {
            const modal = document.getElementById('filterModal');
            modal.classList.remove('show');
            document.body.style.overflow = '';
        }

        // Toggle switch functionality
        function toggleArchived() {
            const toggle = document.getElementById('archivedToggle');
            toggle.classList.toggle('active');
        }

        // Clear all filters
        function clearAllFilters() {
            // Reset all form elements
            const inputs = document.querySelectorAll('#filterModal .filter-input');
            inputs.forEach(input => input.value = '');
            
            const selects = document.querySelectorAll('#filterModal .filter-select');
            selects.forEach(select => select.selectedIndex = 0);
            
            const toggle = document.getElementById('archivedToggle');
            toggle.classList.remove('active');
        }

        // Apply filters
        function applyFilters() {
            // Get filter values
            const labelSearch = document.querySelector('#filterModal .filter-input').value;
            const accountOwner = document.querySelector('#filterModal .filter-select').value;
            const timeFilter = document.querySelectorAll('#filterModal .filter-select')[1].value;
            const timeRange = document.querySelectorAll('#filterModal .filter-select')[2].value;
            const archivedOnly = document.getElementById('archivedToggle').classList.contains('active');
            
            console.log('Applying filters:', {
                labelSearch,
                accountOwner,
                timeFilter,
                timeRange,
                archivedOnly
            });
            
            // Here you would implement the actual filtering logic
            // For now, just close the modal
            closeFilterModal();
            
            // Show notification
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #48bb78;
                color: white;
                padding: 16px 24px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(72, 187, 120, 0.3);
                z-index: 10000;
                font-weight: 600;
            `;
            notification.textContent = 'Filters applied successfully!';
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Create project function
        async function createProject() {
            const projectName = document.getElementById('projectName').value.trim();
            const projectCode = document.getElementById('projectCode').value.trim();
            const projectTemplate = document.getElementById('projectTemplate').value;
            
            // Validation
            if (!projectName) {
                alert('Please enter a project name');
                document.getElementById('projectName').focus();
                return;
            }

            // Show loading state
            const createBtn = document.getElementById('createProjectBtn');
            const originalText = createBtn.textContent;
            createBtn.textContent = 'Creating...';
            createBtn.disabled = true;

            try {
                const response = await fetch('/create-project', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ 
                        name: projectName,
                        code: projectCode,
                        template: projectTemplate
                    })
                });

                const result = await response.json();
                
                if (result.status === 'success') {
                    // Add new project to the list
                    const newProject = {
                        id: result.projectId,
                        name: projectName,
                        code: projectCode,
                        type: projectTemplate,
                        members: 0,
                        status: 'active'
                    };
                    
                    projects.push(newProject);
                    updateProjectsDisplay();
                    
                    // Show success notification
                    const notification = document.createElement('div');
                    notification.style.cssText = `
                        position: fixed;
                        top: 20px;
                        right: 20px;
                        background: #48bb78;
                        color: white;
                        padding: 16px 24px;
                        border-radius: 8px;
                        box-shadow: 0 4px 12px rgba(72, 187, 120, 0.3);
                        z-index: 10001;
                        font-weight: 600;
                    `;
                    notification.textContent = 'Project created successfully!';
                    document.body.appendChild(notification);
                    
                    setTimeout(() => {
                        notification.remove();
                    }, 3000);
                    
                    // Close modal
                    closeCreateProjectModal();
                } else {
                    alert('Failed to create project: ' + result.message);
                }
            } catch (error) {
                console.error('Error creating project:', error);
                alert('Error creating project. Please try again.');
            } finally {
                // Reset button
                createBtn.textContent = originalText;
                createBtn.disabled = false;
            }
        }

        // Update projects display
        function updateProjectsDisplay() {
            const projectsGrid = document.querySelector('.projects-grid');
            const projectCards = projectsGrid.querySelectorAll('.project-card:not(.new-project-card)');
            const currentProjects = getCurrentProjects();
            
            // Remove existing project cards
            projectCards.forEach(card => card.remove());
            
            // Add project cards
            currentProjects.forEach(project => {
                const projectCard = createProjectCard(project);
                projectsGrid.insertBefore(projectCard, projectsGrid.lastElementChild);
            });
            
            // Update project count in the active tab
            const myProjectsCount = document.getElementById('myProjectsCount');
            const accountProjectsCount = document.getElementById('accountProjectsCount');
            
            myProjectsCount.textContent = `(${projects.length})`;
            accountProjectsCount.textContent = `(${accountProjects.length})`;
        }

        // Create project card element
        function createProjectCard(project) {
            const card = document.createElement('div');
            card.className = 'project-card';
            card.innerHTML = `
                <div class="project-actions">
                    <button class="action-btn favorite-btn">‚òÜ</button>
                    <button class="action-btn star-btn">‚≠ê</button>
                    <button class="action-btn menu-btn">‚ãØ</button>
                </div>
                <div class="project-header">
                    <div>
                        <div class="project-title">${project.name}</div>
                        ${project.type ? `<div class="project-type">${project.type}</div>` : ''}
                    </div>
                </div>
                <div class="project-stats">
                    <span class="stat-icon">üë•</span>
                    <span>${project.members}</span>
                </div>
            `;
            
            // Add event listeners for action buttons
            const favoriteBtn = card.querySelector('.favorite-btn');
            const starBtn = card.querySelector('.star-btn');
            const menuBtn = card.querySelector('.menu-btn');
            
            if (favoriteBtn) {
                favoriteBtn.addEventListener('click', function() {
                    toggleFavorite(this);
                });
            }
            if (starBtn) {
                starBtn.addEventListener('click', function() {
                    toggleStar(this);
                });
            }
            if (menuBtn) {
                menuBtn.addEventListener('click', function() {
                    showProjectMenu(this);
                });
            }
            
            // Add click event to open project
            card.addEventListener('click', function(e) {
                if (!e.target.classList.contains('action-btn')) {
                    openProject(project);
                }
            });
            
            return card;
        }

        // Toggle favorite
        function toggleFavorite(btn) {
            btn.textContent = btn.textContent === '‚òÜ' ? '‚òÖ' : '‚òÜ';
            btn.style.color = btn.textContent === '‚òÖ' ? '#fbbf24' : '#a0aec0';
        }

        // Toggle star
        function toggleStar(btn) {
            btn.textContent = btn.textContent === '‚≠ê' ? 'üåü' : '‚≠ê';
            btn.style.color = btn.textContent === 'üåü' ? '#fbbf24' : '#a0aec0';
        }

        // Show project context menu
        function showProjectMenu(btn) {
            const projectId = btn.getAttribute('data-project-id');
            const project = getCurrentProjects().find(p => p.id == projectId);
            
            // Remove any existing menus
            document.querySelectorAll('.context-menu').forEach(menu => menu.remove());
            
            const menu = document.createElement('div');
            menu.className = 'context-menu';
            
            menu.innerHTML = `
                <div class="context-menu-item" data-action="settings">Settings</div>
                <div class="context-menu-item" data-action="copy-link">Copy project link</div>
                <div class="context-menu-separator"></div>
                <div class="context-menu-item" data-action="archive">Archive</div>
                <div class="context-menu-item disabled" data-action="delete">Delete</div>
            `;
            
            // Position the menu
            const btnRect = btn.getBoundingClientRect();
            menu.style.top = (btnRect.bottom + window.scrollY + 5) + 'px';
            menu.style.left = (btnRect.left + window.scrollX - 140) + 'px';
            
            document.body.appendChild(menu);
            
            // Show with animation
            setTimeout(() => {
                menu.classList.add('show');
            }, 10);
            
            // Add click handlers
            const settingsItem = menu.querySelector('[data-action="settings"]');
            const copyLinkItem = menu.querySelector('[data-action="copy-link"]');
            const archiveItem = menu.querySelector('[data-action="archive"]');
            const deleteItem = menu.querySelector('[data-action="delete"]');
            
            if (settingsItem) {
                settingsItem.addEventListener('click', function() {
                    showProjectSettings(project);
                    closeContextMenu();
                });
            }
            if (copyLinkItem) {
                copyLinkItem.addEventListener('click', function() {
                    copyProjectLink(project);
                    closeContextMenu();
                });
            }
            if (archiveItem) {
                archiveItem.addEventListener('click', function() {
                    archiveProject(project);
                    closeContextMenu();
                });
            }
            if (deleteItem) {
                deleteItem.addEventListener('click', function() {
                    // Delete is disabled, but we can show a message
                    showDeleteDisabledMessage();
                    closeContextMenu();
                });
            }
            
            // Close menu when clicking outside
            setTimeout(() => {
                document.addEventListener('click', function closeMenu(e) {
                    if (!menu.contains(e.target) && !btn.contains(e.target)) {
                        closeContextMenu();
                        document.removeEventListener('click', closeMenu);
                    }
                });
            }, 0);
        }

        // Close context menu
        function closeContextMenu() {
            const menus = document.querySelectorAll('.context-menu');
            menus.forEach(menu => menu.remove());
        }

        // Context menu action functions
        function showProjectSettings(project) {
            alert(`Settings for project: ${project.name}\n\nThis would open the project settings modal.`);
        }

        function copyProjectLink(project) {
            const projectUrl = `${window.location.origin}/project/${project.id}`;
            navigator.clipboard.writeText(projectUrl).then(() => {
                // Show success notification
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: #48bb78;
                    color: white;
                    padding: 16px 24px;
                    border-radius: 8px;
                    box-shadow: 0 4px 12px rgba(72, 187, 120, 0.3);
                    z-index: 10000;
                    font-weight: 600;
                `;
                notification.textContent = 'Project link copied to clipboard!';
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.remove();
                }, 3000);
            }).catch(() => {
                alert('Failed to copy project link. Please try again.');
            });
        }

        function archiveProject(project) {
            if (confirm(`Are you sure you want to archive "${project.name}"?`)) {
                // Move project to archived state
                project.isArchived = true;
                
                // Show success notification
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: #3182ce;
                    color: white;
                    padding: 16px 24px;
                    border-radius: 8px;
                    box-shadow: 0 4px 12px rgba(49, 130, 206, 0.3);
                    z-index: 10000;
                    font-weight: 600;
                `;
                notification.textContent = `"${project.name}" has been archived.`;
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.remove();
                }, 3000);
                
                // Update display
                updateProjectsDisplay();
            }
        }

        function showDeleteDisabledMessage() {
            alert('Delete functionality is currently disabled.\n\nPlease contact your administrator if you need to delete a project.');
        }

        // Notification Panel Functions

        // Edit project
        function editProject(element) {
            const projectName = prompt('Enter new project name:');
            if (projectName) {
                const projectCard = element.closest('.project-card');
                const titleElement = projectCard.querySelector('.project-title');
                titleElement.textContent = projectName;
                alert('Project updated successfully!');
            }
        }

        // Duplicate project
        function duplicateProject(element) {
            const projectCard = element.closest('.project-card');
            const titleElement = projectCard.querySelector('.project-title');
            const newName = titleElement.textContent + ' (Copy)';
            
            const newProject = {
                id: Date.now().toString(),
                name: newName,
                type: '',
                members: 0,
                status: 'active'
            };
            
            projects.push(newProject);
            updateProjectsDisplay();
            alert('Project duplicated successfully!');
        }

        // Delete project
        function deleteProject(element) {
            if (confirm('Are you sure you want to delete this project?')) {
                const projectCard = element.closest('.project-card');
                projectCard.remove();
                alert('Project deleted successfully!');
            }
        }

        // Open project
        function openProject(project) {
            // Navigate to mainplan page
            window.location.href = `/mainplan?projectId=${project.id}&name=${encodeURIComponent(project.name)}`;
        }

        // Sort projects - open modal
        function sortProjects() {
            openSortModal();
        }

        // Tab switching functions
        function switchToMyProjects() {
            currentTab = 'myProjects';
            updateTabStates();
            updateProjectsDisplay();
        }

        function switchToAccountProjects() {
            currentTab = 'accountProjects';
            updateTabStates();
            updateProjectsDisplay();
        }

        function updateTabStates() {
            const myProjectsTab = document.getElementById('myProjectsTab');
            const accountProjectsTab = document.getElementById('accountProjectsTab');
            
            if (currentTab === 'myProjects') {
                myProjectsTab.classList.add('active');
                accountProjectsTab.classList.remove('active');
            } else {
                myProjectsTab.classList.remove('active');
                accountProjectsTab.classList.add('active');
            }
        }

        function getCurrentProjects() {
            return currentTab === 'myProjects' ? projects : accountProjects;
        }

        // Sort Modal Functions
        function openSortModal() {
            const modal = document.getElementById('sortModal');
            const sortBtn = document.getElementById('sortBtn');
            const sortModalElement = modal.querySelector('.sort-modal');
            
            // Get the position of the Sort button
            const sortBtnRect = sortBtn.getBoundingClientRect();
            
            // Position the dropdown below the Sort button
            sortModalElement.style.top = (sortBtnRect.bottom + window.scrollY + 5) + 'px';
            sortModalElement.style.left = (sortBtnRect.left + window.scrollX) + 'px';
            
            modal.classList.add('show');
            document.body.style.overflow = 'hidden';
        }

        function closeSortModal() {
            const modal = document.getElementById('sortModal');
            modal.classList.remove('show');
            document.body.style.overflow = '';
        }

        // Apply sort
        function applySort(sortType) {
            console.log('Sorting by:', sortType);
            
            // Update selected option
            const sortOptions = document.querySelectorAll('.sort-option');
            sortOptions.forEach(option => option.classList.remove('selected'));
            document.querySelector(`[data-sort="${sortType}"]`).classList.add('selected');
            
            // Get current projects array
            const currentProjects = getCurrentProjects();
            
            // Sort projects based on type
            switch(sortType) {
                case 'favorite':
                    currentProjects.sort((a, b) => (b.isFavorite ? 1 : 0) - (a.isFavorite ? 1 : 0));
                    break;
                case 'name':
                    currentProjects.sort((a, b) => a.name.localeCompare(b.name));
                    break;
                case 'code':
                    currentProjects.sort((a, b) => (a.code || '').localeCompare(b.code || ''));
                    break;
                case 'label':
                    currentProjects.sort((a, b) => (a.label || '').localeCompare(b.label || ''));
                    break;
            }
            
            // Update display
            updateProjectsDisplay();
            
            // Close modal
            closeSortModal();
            
            // Show notification
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #48bb78;
                color: white;
                padding: 16px 24px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(72, 187, 120, 0.3);
                z-index: 10000;
                font-weight: 600;
            `;
            notification.textContent = `Projects sorted by ${sortType.charAt(0).toUpperCase() + sortType.slice(1)}!`;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Filter projects - open modal
        function filterProjects() {
            openFilterModal();
        }

        // Search functionality
        const searchBox = document.querySelector('.search-box');
        searchBox.addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();
            const projectCards = document.querySelectorAll('.project-card:not(.new-project-card)');
            
            projectCards.forEach(card => {
                const title = card.querySelector('.project-title').textContent.toLowerCase();
                if (title.includes(searchTerm)) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        });

        // Add click animations
        document.querySelectorAll('.new-project-btn, .control-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                this.style.transform = 'scale(0.95)';
                setTimeout(() => {
                    this.style.transform = '';
                }, 150);
            });
        });

        // Toggle user dropdown
        function toggleUserDropdown() {
            const dropdown = document.getElementById('userDropdown');
            dropdown.classList.toggle('show');
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const dropdown = document.getElementById('userDropdown');
            const userDropdown = document.querySelector('.user-dropdown');
            
            if (!userDropdown.contains(event.target)) {
                dropdown.classList.remove('show');
            }
        });

        // Edit profile function
        function editProfile() {
            alert('Edit profile functionality would open here');
        }

        // Invite to project modal
        async function showInviteToProjectModal() {
            console.log('Creating invite to project modal...');

            // Try to use projects from server first
            let userProjects = projects || [];

            console.log('Projects available:', userProjects);

            // If no projects from server, fetch them from API
            if (!userProjects || userProjects.length === 0) {
                try {
                    const response = await fetch('/api/projects');
                    if (response.ok) {
                        const data = await response.json();
                        userProjects = data.projects || [];
                        console.log('Projects from API:', userProjects);
                    }
                } catch (error) {
                    console.error('Error fetching projects:', error);
                }
            }

            // Remove any existing modals first
            const existingModals = document.querySelectorAll('.invite-modal-overlay');
            existingModals.forEach(modal => modal.remove());

            // Generate project options HTML
            let projectOptionsHTML = '';
            if (userProjects && userProjects.length > 0) {
                projectOptionsHTML = userProjects.map((project, index) => {
                    const projectId = project.id || project.name;
                    const borderStyle = index < userProjects.length - 1 ? 'border-bottom: 1px solid #f3f4f6;' : '';
                    return `
                        <div class="project-option" data-project="${projectId}" style="
                            padding: 12px 16px;
                            cursor: pointer;
                            ${borderStyle}
                            transition: background 0.2s;
                            display: flex;
                            align-items: center;
                            gap: 8px;
                        ">
                            <input type="checkbox" class="project-checkbox" data-project="${projectId}" style="
                                width: 16px;
                                height: 16px;
                                margin: 0;
                                accent-color: #3b82f6;
                            ">
                            <label class="project-label" style="
                                margin: 0;
                                cursor: pointer;
                                color: #374151;
                                font-size: 14px;
                            ">${project.name}</label>
                        </div>
                    `;
                }).join('');
            } else {
                projectOptionsHTML = `
                    <div style="
                        padding: 20px 16px;
                        text-align: center;
                        color: #9ca3af;
                        font-size: 14px;
                    ">
                        No projects found. Create a project first.
                    </div>
                `;
            }

            const modal = document.createElement('div');
            modal.className = 'invite-modal-overlay';
            modal.style.cssText = `
                position: fixed !important;
                top: 0 !important;
                left: 0 !important;
                width: 100vw !important;
                height: 100vh !important;
                background: rgba(0, 0, 0, 0.5) !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
                z-index: 999999999 !important;
                backdrop-filter: blur(4px);
            `;

            modal.innerHTML = `
                <div style="
                    background: white;
                    border-radius: 16px;
                    box-shadow: 0 20px 25px rgba(0, 0, 0, 0.15);
                    max-width: 480px;
                    width: 90%;
                    position: relative;
                    z-index: 999999999;
                ">
                    <div style="
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        padding: 24px 24px 0 24px;
                        margin-bottom: 24px;
                    ">
                        <h3 style="
                            margin: 0;
                            color: #1a202c;
                            font-size: 18px;
                            font-weight: 700;
                        ">Invite users to project</h3>
                        <button id="closeInviteModal" style="
                            background: none;
                            border: none;
                            font-size: 20px;
                            color: #9ca3af;
                            cursor: pointer;
                            padding: 4px;
                            transition: color 0.2s;
                        ">√ó</button>
                    </div>

                    <div style="padding: 0 24px 24px 24px;">
                        <div style="margin-bottom: 20px;">
                            <label style="
                                display: block;
                                margin-bottom: 8px;
                                font-weight: 500;
                                color: #374151;
                                font-size: 14px;
                            ">Select projects *</label>
                            <div style="position: relative;">
                                <input type="text" id="projectSearch" placeholder="Search projects" style="
                                    width: 100%;
                                    padding: 12px 16px;
                                    border: 1px solid #d1d5db;
                                    border-radius: 8px;
                                    font-size: 14px;
                                    box-sizing: border-box;
                                ">
                                <div id="projectDropdown" style="
                                    position: absolute;
                                    top: 100%;
                                    left: 0;
                                    right: 0;
                                    background: white;
                                    border: 1px solid #d1d5db;
                                    border-top: none;
                                    border-radius: 0 0 8px 8px;
                                    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                                    z-index: 999999999;
                                    display: none;
                                    max-height: 200px;
                                    overflow-y: auto;
                                ">
                                    <div class="project-option select-all-option" style="
                                        padding: 12px 16px;
                                        cursor: pointer;
                                        border-bottom: 1px solid #f3f4f6;
                                        display: flex;
                                        align-items: center;
                                        gap: 8px;
                                    ">
                                        <input type="checkbox" id="selectAllProjects" style="
                                            width: 16px;
                                            height: 16px;
                                            margin: 0;
                                            accent-color: #3b82f6;
                                        ">
                                        <label for="selectAllProjects" style="
                                            margin: 0;
                                            cursor: pointer;
                                            font-weight: 500;
                                            color: #374151;
                                            font-size: 14px;
                                        ">Select all</label>
                                    </div>
                                    ${projectOptionsHTML}
                                </div>
                            </div>
                        </div>

                        <div style="margin-bottom: 24px;">
                            <label style="
                                display: block;
                                margin-bottom: 8px;
                                font-weight: 500;
                                color: #374151;
                                font-size: 14px;
                            ">Add users (separate emails with commas) *</label>
                            <input type="text" id="inviteEmails" placeholder="Enter user email" style="
                                width: 100%;
                                padding: 12px 16px;
                                border: 1px solid #d1d5db;
                                border-radius: 8px;
                                font-size: 14px;
                                box-sizing: border-box;
                            ">
                        </div>

                        <div style="
                            display: flex;
                            justify-content: flex-end;
                            gap: 12px;
                        ">
                            <button id="importContacts" style="
                                background: white;
                                color: #6b7280;
                                border: 1px solid #d1d5db;
                                padding: 10px 16px;
                                border-radius: 8px;
                                cursor: pointer;
                                font-weight: 500;
                                font-size: 14px;
                            ">Import contacts</button>
                            <button id="sendInvite" style="
                                background: #3b82f6;
                                color: white;
                                border: none;
                                padding: 10px 16px;
                                border-radius: 8px;
                                cursor: pointer;
                                font-weight: 500;
                                font-size: 14px;
                            ">Invite users</button>
                        </div>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);

            const importBtn = modal.querySelector('#importContacts');
            const sendBtn = modal.querySelector('#sendInvite');
            const closeBtn = modal.querySelector('#closeInviteModal');
            const projectSearch = modal.querySelector('#projectSearch');
            const projectDropdown = modal.querySelector('#projectDropdown');
            const projectOptions = modal.querySelectorAll('.project-option');
            const selectAllCheckbox = modal.querySelector('#selectAllProjects');
            const projectCheckboxes = modal.querySelectorAll('.project-checkbox');

            projectSearch.addEventListener('focus', function() {
                projectDropdown.style.display = 'block';
            });

            projectSearch.addEventListener('blur', function() {
                setTimeout(() => {
                    projectDropdown.style.display = 'none';
                }, 200);
            });

            projectSearch.addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                projectOptions.forEach(option => {
                    const label = option.querySelector('.project-label');
                    if (label) {
                        const text = label.textContent.toLowerCase();
                        option.style.display = text.includes(searchTerm) ? 'flex' : 'none';
                    }
                });
            });

            selectAllCheckbox.addEventListener('change', function() {
                projectCheckboxes.forEach(checkbox => {
                    checkbox.checked = this.checked;
                });
                updateProjectSearchValue();
            });

            projectCheckboxes.forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    updateSelectAllState();
                    updateProjectSearchValue();
                });
            });

            projectOptions.forEach(option => {
                option.addEventListener('mouseenter', function() {
                    this.style.background = '#f9fafb';
                });
                option.addEventListener('mouseleave', function() {
                    this.style.background = 'white';
                });
            });

            function updateSelectAllState() {
                const checkedBoxes = modal.querySelectorAll('.project-checkbox:checked');
                const allBoxes = modal.querySelectorAll('.project-checkbox');

                if (checkedBoxes.length === 0) {
                    selectAllCheckbox.indeterminate = false;
                    selectAllCheckbox.checked = false;
                } else if (checkedBoxes.length === allBoxes.length) {
                    selectAllCheckbox.indeterminate = false;
                    selectAllCheckbox.checked = true;
                } else {
                    selectAllCheckbox.indeterminate = true;
                }
            }

            function updateProjectSearchValue() {
                const checkedBoxes = modal.querySelectorAll('.project-checkbox:checked');
                const selectedProjects = Array.from(checkedBoxes).map(cb => {
                    const label = cb.parentElement.querySelector('.project-label');
                    return label ? label.textContent : '';
                }).filter(name => name);

                if (selectedProjects.length === 0) {
                    projectSearch.value = '';
                } else if (selectedProjects.length === 1) {
                    projectSearch.value = selectedProjects[0];
                } else {
                    projectSearch.value = `${selectedProjects.length} projects selected`;
                }
            }

            closeBtn.addEventListener('click', function() {
                modal.remove();
            });

            importBtn.addEventListener('click', function() {
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: #3182ce;
                    color: white;
                    padding: 16px 24px;
                    border-radius: 8px;
                    box-shadow: 0 4px 12px rgba(49, 130, 206, 0.3);
                    z-index: 100002;
                    font-weight: 600;
                `;
                notification.textContent = 'Import contacts functionality would open here';
                document.body.appendChild(notification);

                setTimeout(() => {
                    notification.remove();
                }, 3000);
            });

            sendBtn.addEventListener('click', function() {
                const emails = document.getElementById('inviteEmails').value.trim();
                const checkedBoxes = modal.querySelectorAll('.project-checkbox:checked');
                const selectedProjects = Array.from(checkedBoxes).map(cb => {
                    const label = cb.parentElement.querySelector('.project-label');
                    return label ? label.textContent : '';
                }).filter(name => name);

                if (!emails) {
                    alert('Please enter at least one email address');
                    return;
                }

                if (selectedProjects.length === 0) {
                    alert('Please select at least one project');
                    return;
                }

                processInvitation(emails, selectedProjects.join(', '), '');
                modal.remove();
            });

            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        // Process invitation
        async function processInvitation(emails, project, message) {
            const loadingNotification = document.createElement('div');
            loadingNotification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #3182ce;
                color: white;
                padding: 16px 24px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(49, 130, 206, 0.3);
                z-index: 10000;
                font-weight: 600;
            `;
            loadingNotification.textContent = 'Sending invitations...';
            document.body.appendChild(loadingNotification);

            try {
                const response = await fetch('/people/invite-to-project', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        emails: emails,
                        projects: project,
                        message: message
                    })
                });

                const result = await response.json();
                loadingNotification.remove();

                if (result.status === 'success') {
                    const successNotification = document.createElement('div');
                    successNotification.style.cssText = `
                        position: fixed;
                        top: 20px;
                        right: 20px;
                        background: #48bb78;
                        color: white;
                        padding: 16px 24px;
                        border-radius: 8px;
                        box-shadow: 0 4px 12px rgba(72, 187, 120, 0.3);
                        z-index: 10000;
                        font-weight: 600;
                    `;
                    successNotification.textContent = result.message || `Invitations sent successfully!`;
                    document.body.appendChild(successNotification);

                    setTimeout(() => {
                        successNotification.remove();
                    }, 3000);
                } else {
                    const errorNotification = document.createElement('div');
                    errorNotification.style.cssText = `
                        position: fixed;
                        top: 20px;
                        right: 20px;
                        background: #f56565;
                        color: white;
                        padding: 16px 24px;
                        border-radius: 8px;
                        box-shadow: 0 4px 12px rgba(245, 101, 101, 0.3);
                        z-index: 10000;
                        font-weight: 600;
                    `;
                    errorNotification.textContent = result.message || 'Failed to send invitations.';
                    document.body.appendChild(errorNotification);

                    setTimeout(() => {
                        errorNotification.remove();
                    }, 3000);
                }
            } catch (error) {
                console.error('Error sending invitations:', error);
                loadingNotification.remove();

                const errorNotification = document.createElement('div');
                errorNotification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: #f56565;
                    color: white;
                    padding: 16px 24px;
                    border-radius: 8px;
                    box-shadow: 0 4px 12px rgba(245, 101, 101, 0.3);
                    z-index: 10000;
                    font-weight: 600;
                `;
                errorNotification.textContent = 'Network error. Please try again.';
                document.body.appendChild(errorNotification);

                setTimeout(() => {
                    errorNotification.remove();
                }, 3000);
            }
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            updateProjectsDisplay();
            loadNotifications();

            // Mobile menu toggle
            const mobileMenuToggle = document.getElementById('mobileMenuToggle');
            const mainNav = document.getElementById('mainNav');

            if (mobileMenuToggle && mainNav) {
                mobileMenuToggle.addEventListener('click', function(e) {
                    e.stopPropagation();
                    mainNav.classList.toggle('show');

                    // Toggle icon between bars and times
                    const icon = mobileMenuToggle.querySelector('i');
                    if (mainNav.classList.contains('show')) {
                        icon.className = 'fas fa-times';
                    } else {
                        icon.className = 'fas fa-bars';
                    }
                });

                // Close menu when clicking outside
                document.addEventListener('click', function(e) {
                    if (!mainNav.contains(e.target) && !mobileMenuToggle.contains(e.target)) {
                        mainNav.classList.remove('show');
                        const icon = mobileMenuToggle.querySelector('i');
                        icon.className = 'fas fa-bars';
                    }
                });

                // Close menu when clicking a nav item
                const navItems = mainNav.querySelectorAll('.nav-item');
                navItems.forEach(item => {
                    item.addEventListener('click', function() {
                        mainNav.classList.remove('show');
                        const icon = mobileMenuToggle.querySelector('i');
                        icon.className = 'fas fa-bars';
                    });
                });
            }

            // Add event listeners for buttons
            const newProjectBtn = document.getElementById('newProjectBtn');
            const newProjectCard = document.getElementById('newProjectCard');
            const inviteUserBtn = document.getElementById('inviteUserBtn');
            const sortBtn = document.getElementById('sortBtn');
            const filterBtn = document.getElementById('filterBtn');
            const userDropdownToggle = document.getElementById('userDropdownToggle');
            const editProfileLink = document.getElementById('editProfileLink');

            if (newProjectBtn) {
                newProjectBtn.addEventListener('click', createNewProject);
            }
            if (newProjectCard) {
                newProjectCard.addEventListener('click', createNewProject);
            }
            if (inviteUserBtn) {
                inviteUserBtn.addEventListener('click', showInviteToProjectModal);
            }
            if (sortBtn) {
                sortBtn.addEventListener('click', sortProjects);
            }
            if (filterBtn) {
                filterBtn.addEventListener('click', filterProjects);
            }
            if (userDropdownToggle) {
                userDropdownToggle.addEventListener('click', toggleUserDropdown);
            }
            if (editProfileLink) {
                editProfileLink.addEventListener('click', editProfile);
            }
            
            // Tab event listeners
            const myProjectsTab = document.getElementById('myProjectsTab');
            const accountProjectsTab = document.getElementById('accountProjectsTab');
            
            if (myProjectsTab) {
                myProjectsTab.addEventListener('click', switchToMyProjects);
            }
            if (accountProjectsTab) {
                accountProjectsTab.addEventListener('click', switchToAccountProjects);
            }
            
            // Notification bell functionality
            const notificationBell = document.getElementById('notificationBell');
            if (notificationBell) {
                notificationBell.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const panel = document.getElementById('notificationPanel');
                    const helpPanel = document.getElementById('helpPanel');
                    const userDropdown = document.getElementById('userDropdown');

                    if (helpPanel) helpPanel.classList.remove('show');
                    if (userDropdown) userDropdown.classList.remove('show');
                    if (panel) {
                        panel.classList.toggle('show');
                        if (panel.classList.contains('show')) {
                            renderNotifications(currentFilter);
                        }
                    }
                });
            }

            // Notification filter buttons
            const filterButtons = document.querySelectorAll('.filter-btn');
            if (filterButtons) {
                filterButtons.forEach(btn => {
                    btn.addEventListener('click', function(e) {
                        e.stopPropagation();
                        // Remove active class from all buttons
                        filterButtons.forEach(b => b.classList.remove('active'));
                        // Add active class to clicked button
                        this.classList.add('active');
                        // Get filter value and render
                        const filter = this.getAttribute('data-filter');
                        currentFilter = filter;
                        renderNotifications(filter);
                    });
                });
            }

            // Help icon functionality
            const helpIcon = document.getElementById('helpIcon');
            if (helpIcon) {
                helpIcon.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const panel = document.getElementById('helpPanel');
                    const notificationPanel = document.getElementById('notificationPanel');
                    const userDropdown = document.getElementById('userDropdown');

                    if (notificationPanel) notificationPanel.classList.remove('show');
                    if (userDropdown) userDropdown.classList.remove('show');
                    if (panel) panel.classList.toggle('show');
                });
            }

            // Mark all as read
            const markAllReadBtn = document.getElementById('markAllRead');
            if (markAllReadBtn) {
                markAllReadBtn.addEventListener('click', function() {
                    notifications.forEach(n => n.unread = false);
                    renderNotifications();
                });
            }

            // Close panels when clicking outside
            document.addEventListener('click', function(event) {
                const notificationPanel = document.getElementById('notificationPanel');
                const helpPanel = document.getElementById('helpPanel');
                const notificationBellElem = document.getElementById('notificationBell');
                const helpIconElem = document.getElementById('helpIcon');

                if (notificationPanel && notificationBellElem) {
                    if (!notificationBellElem.contains(event.target) && !notificationPanel.contains(event.target)) {
                        notificationPanel.classList.remove('show');
                    }
                }

                if (helpPanel && helpIconElem) {
                    if (!helpIconElem.contains(event.target) && !helpPanel.contains(event.target)) {
                        helpPanel.classList.remove('show');
                    }
                }
            });
            
            
            // Sort modal event listeners
            const sortOptions = document.querySelectorAll('.sort-option');
            const sortModal = document.getElementById('sortModal');
            if (sortOptions) {
                sortOptions.forEach(option => {
                    option.addEventListener('click', function() {
                        const sortType = this.getAttribute('data-sort');
                        applySort(sortType);
                    });
                });
            }
            if (sortModal) {
                sortModal.addEventListener('click', function(e) {
                    if (e.target === sortModal) {
                        closeSortModal();
                    }
                });
            }
            
            // Close sort modal when clicking anywhere outside
            document.addEventListener('click', function(e) {
                const sortModalOverlay = document.getElementById('sortModal');
                const sortBtn = document.getElementById('sortBtn');
                if (sortModalOverlay && sortModalOverlay.classList.contains('show')) {
                    if (!sortModalOverlay.contains(e.target) && !sortBtn.contains(e.target)) {
                        closeSortModal();
                    }
                }
            });

            // Filter modal event listeners
            const closeFilterModalBtn = document.getElementById('closeFilterModal');
            const clearFiltersBtn = document.getElementById('clearFiltersBtn');
            const viewProjectsBtn = document.getElementById('viewProjectsBtn');
            const archivedToggle = document.getElementById('archivedToggle');
            const filterModal = document.getElementById('filterModal');
            
            if (closeFilterModalBtn) {
                closeFilterModalBtn.addEventListener('click', closeFilterModal);
            }
            if (clearFiltersBtn) {
                clearFiltersBtn.addEventListener('click', clearAllFilters);
            }
            if (viewProjectsBtn) {
                viewProjectsBtn.addEventListener('click', applyFilters);
            }
            if (archivedToggle) {
                archivedToggle.addEventListener('click', toggleArchived);
            }
            if (filterModal) {
                filterModal.addEventListener('click', function(e) {
                    if (e.target === filterModal) {
                        closeFilterModal();
                    }
                });
            }
        });

        // Global click handler to close notification panel when clicking outside
        document.addEventListener('click', function(e) {
            const notificationPanel = document.getElementById('notificationPanel');
            const notificationBell = document.querySelector('.notification-icon');

            if (notificationPanel && notificationPanel.classList.contains('show')) {
                // Check if click is outside both the panel and the bell icon
                if (!notificationPanel.contains(e.target) && !notificationBell.contains(e.target)) {
                    notificationPanel.classList.remove('show');
                }
            }
        });

        // Global Escape key handler to close notification panel
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                const notificationPanel = document.getElementById('notificationPanel');
                if (notificationPanel && notificationPanel.classList.contains('show')) {
                    notificationPanel.classList.remove('show');
                }
            }
        });

        // Sign out functionality
        async function signOut() {
            try {
                // Show loading state
                const signOutBtn = document.querySelector('a[onclick="signOut()"]');
                const originalText = signOutBtn.textContent;
                signOutBtn.textContent = 'Signing out...';
                signOutBtn.style.pointerEvents = 'none';

                // Call logout API
                const response = await fetch('/auth/logout', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });

                const result = await response.json();

                if (result.success) {
                    // Show success message
                    const notification = document.createElement('div');
                    notification.style.cssText = `
                        position: fixed;
                        top: 20px;
                        right: 20px;
                        background: #48bb78;
                        color: white;
                        padding: 16px 24px;
                        border-radius: 8px;
                        box-shadow: 0 4px 12px rgba(72, 187, 120, 0.3);
                        z-index: 10000;
                        font-weight: 600;
                    `;
                    notification.textContent = 'Signed out successfully. Redirecting...';
                    document.body.appendChild(notification);

                    // Redirect to login page after a short delay
                    setTimeout(() => {
                        window.location.href = '/login';
                    }, 1500);

                } else {
                    // Show error message
                    const notification = document.createElement('div');
                    notification.style.cssText = `
                        position: fixed;
                        top: 20px;
                        right: 20px;
                        background: #f56565;
                        color: white;
                        padding: 16px 24px;
                        border-radius: 8px;
                        box-shadow: 0 4px 12px rgba(245, 101, 101, 0.3);
                        z-index: 10000;
                        font-weight: 600;
                    `;
                    notification.textContent = 'Sign out failed. Please try again.';
                    document.body.appendChild(notification);

                    // Reset button
                    signOutBtn.textContent = originalText;
                    signOutBtn.style.pointerEvents = 'auto';

                    // Remove notification after 3 seconds
                    setTimeout(() => {
                        notification.remove();
                    }, 3000);
                }

            } catch (error) {
                console.error('Sign out error:', error);
                
                // Show error message
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: #f56565;
                    color: white;
                    padding: 16px 24px;
                    border-radius: 8px;
                    box-shadow: 0 4px 12px rgba(245, 101, 101, 0.3);
                    z-index: 10000;
                    font-weight: 600;
                `;
                notification.textContent = 'Connection error. Please try again.';
                document.body.appendChild(notification);

                // Reset button
                const signOutBtn = document.querySelector('a[onclick="signOut()"]');
                signOutBtn.textContent = 'Sign out';
                signOutBtn.style.pointerEvents = 'auto';

                // Remove notification after 3 seconds
                setTimeout(() => {
                    notification.remove();
                }, 3000);
            }
        }
    </script>
</body>
</html>